<h1>Delivery Tracker</h1>
<p>Know if something gets lost in the mail.</p>

<hr>


<h2>Expecting a package?</h2>

<% if notice.present? %>
  <div class="alert alert-success"><%= notice %></div>
<% end %>
<% if alert.present? %>
  <div class="alert alert-danger"><%= alert %></div>
<% end %>

<%= form_tag("/insert_delivery", method: :post) do %>

  <div>
    <label for="description">Description</label>
    <%= text_field_tag(:query_description, nil, id: "description") %>
  </div>

  <div>
    <label for="expected_on">Supposed to arrive on</label>
    <%= date_field_tag(:query_expected_on, nil, id: "expected_on") %>
  </div>

  <div>
    <label for="details">Details</label>
    <%= text_area_tag(:query_details, nil, id: "details") %>
  </div>

  <div>
    <button type="submit">Log delivery</button>
  </div>
<% end %>

<hr>

<div class="waiting_on">
  <h2>Waiting on</h2>

  <ul>
   <% @list_of_deliveries.select { |d| !d.received }.each do |delivery| %>
      <li>
        <div><%= delivery.description %></div>
        <div>
          Supposed to arrive on
          <%= delivery.expected_on.strftime("%Y-%m-%d") %>
        </div>

        <div><%= delivery.details %></div>

        <div>
          <%= form_with url: "/modify_delivery/#{delivery.id}", method: :post, local: true do |form| %>
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
            <%= hidden_field_tag :received, true %>
            <button type="submit">Mark as received</button>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
</div>

<hr>

<div class="received">
  <h2>Received</h2>

  <% received = @list_of_deliveries.select { |d| d.received } %>
  <% if received.any? %>
   <ul>
  <% received.each do |delivery| %>
    <li>
      <div><%= delivery.description %></div>
      <div>Arrived on: <%= delivery.updated_at.strftime("%Y-%m-%d") %></div>
      <%= link_to "Delete", "/delete_delivery/#{delivery.id}", method: :delete, data: { confirm: "Are you sure?" } %>
    </li>
  <% end %>
</ul>
  <% else %>
    <p>No received deliveries yet.</p>
  <% end %>
</div>
